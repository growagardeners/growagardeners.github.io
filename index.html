<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grow A Garden - Premium Rewards System</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Fredoka+One&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Neue', cursive;
            background:
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%),
                linear-gradient(135deg, #50d2da 0%, #42777f 25%, #1aacb5 50%, #4ecdc4 75%, #50d2da 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            animation: gradientShift 10s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(10deg); }
        }

        /* Enhanced animated sparkles background */
        .sparkles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .sparkle {
            position: absolute;
            border-radius: 50%;
            animation: sparkle-fall linear infinite;
            box-shadow: 0 0 6px currentColor;
        }

        @keyframes sparkle-fall {
            0% {
                top: -10px;
                opacity: 0;
                transform: scale(0) rotate(0deg);
            }
            10% {
                opacity: 1;
                transform: scale(1) rotate(36deg);
            }
            90% {
                opacity: 1;
                transform: scale(1) rotate(324deg);
            }
            100% {
                top: 110vh;
                opacity: 0;
                transform: scale(0) rotate(360deg);
            }
        }

        /* Enhanced header styles */
        .grass-header {
            background:
                linear-gradient(145deg, #a8e6cf 0%, #7fcdcd 25%, #81c784 50%, #4caf50 75%, #388e3c 100%);
            text-align: center;
            padding: 40px 30px;
            margin: 30px;
            border-radius: 30px 30px 0 0;
            box-shadow:
                0 10px 0 #2e7d32,
                0 20px 40px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.2);
            position: relative;
            z-index: 2;
            overflow: hidden;
        }

        .title {
            font-family: 'Fredoka One', cursive;
            font-size: 4rem;
            color: white;
            text-shadow:
                4px 4px 0 #1b5e20,
                8px 8px 20px rgba(0,0,0,0.5);
            margin-bottom: 15px;
            animation: titleGlow 2s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            from { filter: drop-shadow(0 0 10px rgba(255,255,255,0.5)); }
            to { filter: drop-shadow(0 0 20px rgba(255,255,255,0.8)); }
        }

        .subtitle {
            font-size: 1.8rem;
            color: #e8f5e8;
            font-weight: 700;
            text-shadow: 3px 3px 0 #1b5e20;
        }

        /* Enhanced main container */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        .content {
            background:
                linear-gradient(145deg, #8b4513 0%, #d2691e 25%, #cd853f 50%, #8b4513 75%, #5d2e0c 100%);
            margin: 0 30px 30px;
            padding: 50px;
            border-radius: 0 0 30px 30px;
            box-shadow:
                0 12px 0 #3d1a00,
                0 25px 50px rgba(0,0,0,0.5),
                inset 0 1px 0 rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }

        /* Inventory System */
        .inventory-section {
            background: linear-gradient(145deg, #2c3e50, #34495e);
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 30px;
            color: white;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .inventory-title {
            font-family: 'Fredoka One', cursive;
            font-size: 1.8rem;
            margin-bottom: 15px;
            text-align: center;
            color: #ecf0f1;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            min-height: 80px;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            border: 2px dashed #7f8c8d;
        }

        .inventory-item {
            background: linear-gradient(145deg, #3498db, #2980b9);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80px;
            animation: itemAppear 0.5s ease-in-out;
        }

        @keyframes itemAppear {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

        .inventory-empty {
            text-align: center;
            color: #95a5a6;
            font-style: italic;
            padding: 20px;
            grid-column: 1 / -1;
        }

        .activate-button-container {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
        }

        .activate-all-button {
            background: linear-gradient(145deg, #ff9800 0%, #f57c00 25%, #ef6c00 50%, #e65100 75%, #bf360c 100%);
            border: none;
            color: white;
            padding: 18px 35px;
            border-radius: 30px;
            font-family: 'Fredoka One', cursive;
            font-size: 1.4rem;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow:
                0 8px 0 #b71c1c,
                0 15px 30px rgba(255, 152, 0, 0.4);
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
            animation: activateButtonPulse 2s ease-in-out infinite;
        }

        @keyframes activateButtonPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Enhanced pets grid */
        .pets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .pet-card {
            background: linear-gradient(145deg, #81d4fa 0%, #4fc3f7 25%, #29b6f6 50%, #03a9f4 75%, #0288d1 100%);
            border-radius: 25px;
            padding: 30px;
            text-align: center;
            box-shadow:
                0 8px 0 #0277bd,
                0 15px 35px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.3);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .pet-image {
            width: 100px;
            height: 100px;
            background:
                radial-gradient(circle, #ffffff 0%, #f5f5f5 100%);
            border-radius: 20px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            box-shadow:
                0 6px 12px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.8);
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .pet-image img {
            width: 90%;
            height: 90%;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }

        .pet-name {
            font-family: 'Fredoka One', cursive;
            font-size: 1.6rem;
            color: #0d47a1;
            margin-bottom: 10px;
            text-shadow:
                2px 2px 0 rgba(255,255,255,0.8),
                2px 2px 8px rgba(0,0,0,0.3);
        }

        .pet-rarity {
            font-size: 1rem;
            margin-bottom: 20px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .rarity-epic { color: #7b1fa2; text-shadow: 1px 1px 2px rgba(255,255,255,0.8); }
        .rarity-rare { color: #1976d2; text-shadow: 1px 1px 2px rgba(255,255,255,0.8); }
        .rarity-legendary { color: #f57c00; text-shadow: 1px 1px 2px rgba(255,255,255,0.8); }
        .rarity-mythic { color: #d32f2f; text-shadow: 1px 1px 2px rgba(255,255,255,0.8); }

        /* Enhanced claim button */
        .claim-button {
            background: linear-gradient(145deg, #ff6b6b 0%, #ee5a24 25%, #e55039 50%, #c44569 75%, #8b3a62 100%);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 30px;
            font-family: 'Fredoka One', cursive;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow:
                0 6px 0 #5c2c54,
                0 12px 25px rgba(0,0,0,0.4);
            text-transform: uppercase;
            letter-spacing: 2px;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .claim-button.claimed {
            background: linear-gradient(145deg, #27ae60, #2ecc71);
            box-shadow: 0 6px 0 #1e8449;
        }

        /* Enhanced reward tabs */
        .reward-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab-button {
            background: linear-gradient(145deg, #26c6da, #00acc1, #0097a7);
            border: none;
            padding: 15px 30px;
            border-radius: 20px;
            color: white;
            font-family: 'Fredoka One', cursive;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow:
                0 6px 0 #00838f,
                0 10px 25px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        .tab-button.active {
            background: linear-gradient(145deg, #ff5722, #f4511e, #d84315);
            box-shadow:
                0 6px 0 #bf360c,
                0 10px 25px rgba(255, 87, 34, 0.4);
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .title {
                font-size: 2.8rem;
            }

            .content {
                padding: 30px 20px;
                margin: 0 15px 15px;
            }

            .pets-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
            }

            .tab-button {
                padding: 12px 20px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Enhanced animated sparkles background -->
    <div class="sparkles" id="sparkles"></div>

    <div class="main-container">
        <!-- Enhanced Header -->
        <div class="grass-header">
            <h1 class="title">Claim Rewards</h1>
            <p class="subtitle">Choose any Premium Reward:</p>
        </div>

        <div class="content">
            <!-- Inventory System -->
            <div class="inventory-section">
                <div class="inventory-title">🎒 Your Inventory</div>
                <div class="inventory-grid" id="inventoryGrid">
                    <div class="inventory-empty">Claim rewards to fill your inventory!</div>
                </div>
                <div class="activate-button-container" id="activateButtonContainer" style="display: none;">
                    <button class="activate-all-button" id="activateAllButton">
                        🚀 Activate All Rewards (Complete 3 Offers)
                    </button>
                </div>
            </div>

            <!-- Enhanced reward category tabs -->
            <div class="reward-tabs">
                <button class="tab-button active" data-category="pets">🐝 Pets</button>
                <button class="tab-button" data-category="sheckels">💰 Sheckels</button>
            </div>

            <!-- Enhanced pets grid -->
            <div class="pets-grid" id="petsGrid">
                <div class="pet-card" data-rarity="epic">
                    <div class="pet-image">
                        <img src="https://ext.same-assets.com/3655081281/1703335658.webp" alt="Disco Bee" crossorigin="anonymous" onerror="this.parentNode.innerHTML='🐝'">
                    </div>
                    <div class="pet-name">Disco Bee</div>
                    <div class="pet-rarity rarity-epic">Epic Pet</div>
                    <button class="claim-button" data-reward="disco-bee">ADD TO INVENTORY</button>
                </div>
                <div class="pet-card" data-rarity="rare">
                    <div class="pet-image">
                        <img src="https://ext.same-assets.com/3655081281/1616117574.png" alt="Dragonfly" crossorigin="anonymous" onerror="this.parentNode.innerHTML='🐲'">
                    </div>
                    <div class="pet-name">Dragonfly</div>
                    <div class="pet-rarity rarity-rare">Rare Pet</div>
                    <button class="claim-button" data-reward="dragonfly">ADD TO INVENTORY</button>
                </div>
                <div class="pet-card" data-rarity="legendary">
                    <div class="pet-image">
                        <img src="https://ext.same-assets.com/3655081281/1479596056.png" alt="Raccoon" crossorigin="anonymous" onerror="this.parentNode.innerHTML='🦝'">
                    </div>
                    <div class="pet-name">Raccoon</div>
                    <div class="pet-rarity rarity-legendary">Legendary Pet</div>
                    <button class="claim-button" data-reward="raccoon">ADD TO INVENTORY</button>
                </div>
                <div class="pet-card" data-rarity="mythic">
                    <div class="pet-image">
                        <img src="https://ext.same-assets.com/3655081281/3377723608.png" alt="Candy Blossom" crossorigin="anonymous" onerror="this.parentNode.innerHTML='🌸'">
                    </div>
                    <div class="pet-name">Candy Blossom</div>
                    <div class="pet-rarity rarity-mythic">Mythic Item</div>
                    <button class="claim-button" data-reward="candy-blossom">ADD TO INVENTORY</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global reward data
        const rewardData = {
            pets: [
                {
                    image: 'https://ext.same-assets.com/3655081281/1703335658.webp',
                    fallback: '🐝',
                    name: 'Disco Bee',
                    rarity: 'epic',
                    id: 'disco-bee',
                    type: 'Pet'
                },
                {
                    image: 'https://ext.same-assets.com/3655081281/1616117574.png',
                    fallback: '🐲',
                    name: 'Dragonfly',
                    rarity: 'rare',
                    id: 'dragonfly',
                    type: 'Pet'
                },
                {
                    image: 'https://ext.same-assets.com/3655081281/1479596056.png',
                    fallback: '🦝',
                    name: 'Raccoon',
                    rarity: 'legendary',
                    id: 'raccoon',
                    type: 'Pet'
                },
                {
                    image: 'https://ext.same-assets.com/3655081281/3377723608.png',
                    fallback: '🌸',
                    name: 'Candy Blossom',
                    rarity: 'mythic',
                    id: 'candy-blossom',
                    type: 'Item'
                }
            ],
            sheckels: [
                {fallback: '💰', name: '100,000 Sheckels', rarity: 'common', id: 'sheckels-100k', type: 'Currency'},
                {fallback: '💰', name: '500,000 Sheckels', rarity: 'rare', id: 'sheckels-500k', type: 'Currency'},
                {fallback: '💎', name: '1,000,000 Sheckels', rarity: 'epic', id: 'sheckels-1m', type: 'Currency'},
                {fallback: '👑', name: '10,000,000 Sheckels', rarity: 'legendary', id: 'sheckels-10m', type: 'Currency'},
                {fallback: '🌟', name: '100,000,000 Sheckels', rarity: 'mythic', id: 'sheckels-100m', type: 'Currency'},
                {fallback: '🎁', name: '1,000,000,000,000 Sheckels', rarity: 'mythic', id: 'sheckels-1t', type: 'Currency'}
            ]
        };

        // Inventory System
        class InventoryManager {
            constructor() {
                this.inventory = JSON.parse(localStorage.getItem('grow-garden-inventory') || '[]');
                this.updateDisplay();
            }

            addItem(item) {
                const inventoryItem = {
                    id: item.id,
                    name: item.name,
                    rarity: item.rarity,
                    type: item.type || 'Pet',
                    timestamp: Date.now()
                };

                this.inventory.push(inventoryItem);
                this.save();
                this.updateDisplay();
                return inventoryItem;
            }

            hasItem(itemId) {
                return this.inventory.some(item => item.id === itemId);
            }

            getItemCount() {
                return this.inventory.length;
            }

            save() {
                localStorage.setItem('grow-garden-inventory', JSON.stringify(this.inventory));
            }

            updateDisplay() {
                const inventoryGrid = document.getElementById('inventoryGrid');
                const activateButtonContainer = document.getElementById('activateButtonContainer');

                if (this.inventory.length === 0) {
                    inventoryGrid.innerHTML = '<div class="inventory-empty">Claim rewards to fill your inventory!</div>';
                    activateButtonContainer.style.display = 'none';
                    return;
                }

                inventoryGrid.innerHTML = this.inventory.map(item => `
                    <div class="inventory-item rarity-${item.rarity}">
                        <div style="font-size: 1.2rem; margin-bottom: 5px;">
                            ${this.getItemEmoji(item)}
                        </div>
                        <div>${item.name}</div>
                        <div style="font-size: 0.7rem; opacity: 0.8;">${item.type}</div>
                    </div>
                `).join('');

                // Show activate button when there are items in inventory
                activateButtonContainer.style.display = 'block';
                const activateButton = document.getElementById('activateAllButton');
                const itemCount = this.inventory.length;
                activateButton.innerHTML = `🚀 Activate ${itemCount} Reward${itemCount > 1 ? 's' : ''} (Complete 3 Offers)`;
            }

            getItemEmoji(item) {
                const emojiMap = {
                    'disco-bee': '🐝',
                    'dragonfly': '🐲',
                    'raccoon': '🦝',
                    'candy-blossom': '🌸',
                    'sheckels-100k': '💰',
                    'sheckels-500k': '💰',
                    'sheckels-1m': '💎',
                    'sheckels-10m': '👑',
                    'sheckels-100m': '🌟',
                    'sheckels-1t': '🎁'
                };
                return emojiMap[item.id] || '🎁';
            }
        }

        const inventoryManager = new InventoryManager();

        // Enhanced sparkles animation
        function createSparkles() {
            const sparklesContainer = document.getElementById('sparkles');
            const colors = ['#ffffff', '#ffd700', '#ff69b4', '#00ffff', '#98fb98', '#ffa500'];

            function addSparkle() {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.width = sparkle.style.height = (Math.random() * 4 + 2) + 'px';
                sparkle.style.animationDelay = Math.random() * 3 + 's';
                sparkle.style.animationDuration = (Math.random() * 4 + 3) + 's';
                sparkle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];

                sparklesContainer.appendChild(sparkle);

                setTimeout(() => {
                    if (sparkle.parentNode) {
                        sparkle.parentNode.removeChild(sparkle);
                    }
                }, 7000);
            }

            // Create initial sparkles
            for (let i = 0; i < 12; i++) {
                setTimeout(addSparkle, i * 300);
            }

            // Continue adding sparkles
            setInterval(addSparkle, 600);
        }

        // Enhanced tab switching functionality
        function initializeTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const petsGrid = document.getElementById('petsGrid');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active class from all buttons
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    // Add active class to clicked button
                    button.classList.add('active');

                    // Get category and update grid
                    const category = button.dataset.category;
                    updateRewardsGrid(rewardData[category]);
                });
            });
        }

        function updateRewardsGrid(rewards) {
            const petsGrid = document.getElementById('petsGrid');
            petsGrid.innerHTML = '';

            rewards.forEach(reward => {
                const card = document.createElement('div');
                card.className = 'pet-card';
                card.dataset.rarity = reward.rarity;

                let imageContent;
                if (reward.image) {
                    imageContent = `<img src="${reward.image}" alt="${reward.name}" crossorigin="anonymous" onerror="this.parentNode.innerHTML='${reward.fallback}'">`;
                } else {
                    imageContent = reward.fallback;
                }

                // Check if already claimed
                const isClaimed = inventoryManager.hasItem(reward.id);
                const buttonClass = isClaimed ? 'claim-button claimed' : 'claim-button';
                const buttonText = isClaimed ? '✅ IN INVENTORY' : 'ADD TO INVENTORY';

                card.innerHTML = `
                    <div class="pet-image">${imageContent}</div>
                    <div class="pet-name">${reward.name}</div>
                    <div class="pet-rarity rarity-${reward.rarity}">${capitalizeFirst(reward.rarity)} ${reward.type}</div>
                    <button class="${buttonClass}" data-reward="${reward.id}" ${isClaimed ? 'disabled' : ''}>${buttonText}</button>
                `;

                petsGrid.appendChild(card);
            });

            // Re-attach event listeners
            attachClaimListeners();
        }

        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        let currentReward = '';
        let completedOffers = 0;

        function attachClaimListeners() {
            const claimButtons = document.querySelectorAll('.claim-button:not(.claimed)');

            claimButtons.forEach(button => {
                button.addEventListener('click', function() {
                    if (this.disabled) return;

                    currentReward = this.dataset.reward;

                    // Add enhanced loading state
                    const originalText = this.textContent;
                    this.innerHTML = '<div class="loading"></div> Adding to Inventory...';
                    this.disabled = true;

                    // Immediately add reward to inventory
                    const allRewards = {
                        ...rewardData.pets.reduce((acc, item) => ({...acc, [item.id]: item}), {}),
                        ...rewardData.sheckels.reduce((acc, item) => ({...acc, [item.id]: item}), {})
                    };

                    const reward = allRewards[currentReward];
                    if (reward) {
                        // Add to inventory immediately
                        inventoryManager.addItem(reward);

                        // Update button to claimed state
                        this.textContent = '✅ IN INVENTORY';
                        this.className = 'claim-button claimed';
                        this.disabled = true;
                    }
                });
            });
        }

        function attachActivateListener() {
            const activateButton = document.getElementById('activateAllButton');
            if (activateButton) {
                activateButton.addEventListener('click', function() {
                    // Add loading state
                    const originalText = this.innerHTML;
                    this.innerHTML = '<div class="loading"></div> Preparing Activation...';
                    this.disabled = true;

                    // Reset offer completion counter
                    completedOffers = 0;

                    setTimeout(() => {
                        this.innerHTML = originalText;
                        this.disabled = false;
                        showTapRainOffers();
                    }, 1000);
                });
            }
        }

        // TapRain Offers System - NEW ROBLOX APPROACH
        function showTapRainOffers() {
            const overlay = document.createElement('div');
            overlay.className = 'tap-rain-modal-overlay';
            overlay.style.display = 'flex';
            overlay.style.backgroundColor = 'rgba(0,0,0,0.3)';

            const modal = document.createElement('div');
            modal.className = 'tap-rain-modal';

            const contentContainer = document.createElement('div');
            contentContainer.className = 'tap-rain-modal-content';

            contentContainer.innerHTML = "<div class=\"offers-grid roblox-theme\" data-template-id=\"roblox-modal\"> <div class=\"shine-effect\"></div> <div class=\"roblox-header\"> <div class=\"robux-container\"> <img src=\"https://ext.same-assets.com/3655081281/1479596056.png\" class=\"robux-icon\" alt=\"Raccoon\" crossorigin=\"anonymous\" onerror=\"this.parentNode.innerHTML='🦝'\"> <div class=\"glow-effect\"></div> </div> <h2 class=\"offer-header\">Activate Your Garden Rewards!</h2> </div> <div class=\"offers-subtitle\">Complete any offer below to unlock your collected pets and items</div> <div class=\"verification-steps\"> <div class=\"step active\"> <div class=\"step-circle\">1</div> <div class=\"step-text\">Choose</div> </div> <div class=\"step-line\"></div> <div class=\"step\"> <div class=\"step-circle\">2</div> <div class=\"step-text\">Complete</div> </div> <div class=\"step-line\"></div> <div class=\"step\"> <div class=\"step-circle\">3</div> <div class=\"step-text\">Get Rewards</div> </div> </div> <div class=\"offers-container\"> <div id=\"offerContainer\" class=\"grid\"></div> </div> <div class=\"secure-note\"> <span class=\"secure-icon\">🔒</span> Secure verification process </div></div>";

            const style = document.createElement('style');
            style.textContent = "@import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');.offers-grid.roblox-theme { padding: 1.5rem; background: linear-gradient(135deg, #f8f9fa, #ffffff); border-radius: 8px; border-top: 5px solid #4CAF50; font-family: 'Nunito', 'Helvetica Neue', Arial, sans-serif; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); position: relative; overflow: hidden;}.offers-grid.roblox-theme::before { content: ''; position: absolute; top: 0; right: 0; width: 180px; height: 180px; background: radial-gradient(circle, rgba(0, 162, 255, 0.1) 0%, rgba(255, 255, 255, 0) 70%); border-radius: 50%; z-index: 0;}.roblox-header { display: flex; align-items: center; justify-content: center; margin-bottom: 12px; position: relative;}.robux-container { position: relative; display: flex; align-items: center; justify-content: center; margin-right: 10px;}.robux-icon { width: 45px; height: 45px; filter: drop-shadow(0 4px 8px rgba(0,162,255,0.4)); animation: float 3s ease-in-out infinite; z-index: 2; border-radius: 8px;}.glow-effect { position: absolute; width: 65px; height: 65px; background: radial-gradient(circle, rgba(76,175,80,0.6) 0%, rgba(76,175,80,0) 70%); border-radius: 50%; animation: pulse 2s ease-in-out infinite; z-index: 1;}@keyframes float { 0% { transform: translateY(0px) rotate(0deg); } 50% { transform: translateY(-5px) rotate(5deg); } 100% { transform: translateY(0px) rotate(0deg); }}@keyframes pulse { 0% { transform: scale(0.8); opacity: 0.6; } 50% { transform: scale(1.2); opacity: 0.8; } 100% { transform: scale(0.8); opacity: 0.6; }}.offer-header { color: #1B1B1B; font-size: 22px; font-weight: 800; text-align: center; margin: 0; background: linear-gradient(90deg, #4CAF50, #388E3C); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 0 2px 10px rgba(76,175,80,0.2); letter-spacing: -0.5px;}.offers-subtitle { color: #757575; font-size: 14px; text-align: center; margin-bottom: 15px;}.verification-steps { display: flex; justify-content: center; align-items: center; margin-bottom: 20px; background: rgba(76,175,80,0.05); border-radius: 30px; padding: 10px; position: relative; z-index: 1;}.step { display: flex; flex-direction: column; align-items: center; position: relative; z-index: 2;}.step-circle { width: 28px; height: 28px; background-color: #e0e0e0; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #757575; font-weight: 700; font-size: 13px; margin-bottom: 5px; transition: all 0.3s ease;}.step.active .step-circle { background: linear-gradient(135deg, #4CAF50, #388E3C); color: white; box-shadow: 0 0 0 3px rgba(76,175,80,0.2), 0 5px 10px rgba(0,0,0,0.1); transform: scale(1.1);}.step-text { font-size: 12px; color: #757575; font-weight: 600; transition: all 0.3s ease;}.step.active .step-text { color: #388E3C; font-weight: 700;}.step-line { width: 45px; height: 3px; background-color: #e0e0e0; margin: 0 5px; margin-bottom: 25px; position: relative; border-radius: 3px; overflow: hidden;}.step-line::after { content: ''; position: absolute; top: 0; left: 0; height: 100%; width: 0; background: linear-gradient(90deg, #4CAF50, #388E3C); transition: width 0.5s ease;}.offer-item { background: linear-gradient(145deg, #ffffff, #f0f7ff); border: 1px solid #dee2e6; border-left: 4px solid #00A2FF; border-radius: 8px; padding: 0.9375rem; margin-bottom: 0; color: #333333; font-size: 0.875rem; font-weight: 400; transition: all 200ms ease; cursor: pointer; display: flex; flex-direction: column; position: relative; overflow: hidden; z-index: 1; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.06); font-family: ;}.offer-item::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient( 90deg, transparent, rgba(255, 255, 255, 0.2), transparent ); transition: 0.5s;}.offer-item::after { content: '›'; position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #4CAF50; font-size: 24px; font-weight: bold; opacity: 0.5; transition: all 0.3s ease;}.offer-item:hover { background: linear-gradient(135deg, #f0f7ff, #ffffff); transform: translateY(-5px) scale(1.02); box-shadow: 0 12px 20px rgba(76, 175, 80, 0.15); border-color: #4CAF50;}.offer-item:hover::before { left: 100%;}.offer-item:hover::after { opacity: 1; right: 12px; transform: translateY(-50%) scale(1.2);}.offer-title { font-weight: 700; font-size: 15px; margin-bottom: 8px; color: #0055a4; padding-right: 25px; transition: all 0.2s ease; position: relative; display: flex; align-items: center;}.offer-title::before { content: ''; display: inline-block; width: 8px; height: 8px; background-color: #4CAF50; border-radius: 50%; margin-right: 8px; opacity: 0.8;}.offer-item:hover .offer-title { color: #0073E6; transform: translateX(5px);}.offer-item:nth-child(3n+1) { border-left-color: #4CAF50;}.offer-item:nth-child(3n+2) { border-left-color: #39D353;}.offer-item:nth-child(3n+3) { border-left-color: #FF6B6B;}.offer-item:nth-child(odd) { border-top-right-radius: 20px; border-bottom-left-radius: 20px;}.offer-item:nth-child(even) { border-top-left-radius: 20px; border-bottom-right-radius: 20px;}.offers-container { position: relative; margin-bottom: 15px;}.best-value-tag { position: absolute; top: -10px; left: 20px; background: linear-gradient(90deg, #FF6B6B, #FF8E53); color: white; font-size: 11px; font-weight: 800; padding: 4px 10px; border-radius: 20px; letter-spacing: 0.5px; box-shadow: 0 3px 6px rgba(255, 107, 107, 0.3); z-index: 2;}.secure-note { margin-top: 15px; text-align: center; color: #757575; font-size: 12px; font-weight: 600; display: flex; align-items: center; justify-content: center; background: rgba(76,175,80,0.08); padding: 8px 15px; border-radius: 20px; width: fit-content; margin-left: auto; margin-right: auto;}.secure-icon { margin-right: 8px; font-size: 12px;}.shine-effect { position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient( to right, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.1) 50%, rgba(255, 255, 255, 0) 100% ); transform: rotate(30deg); animation: shine 6s infinite; pointer-events: none; z-index: 0;}@keyframes shine { 0% { transform: translateX(-100%) rotate(30deg); } 20%, 100% { transform: translateX(100%) rotate(30deg); }}#offerContainer { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; max-height: 350px; overflow-y: auto; padding: 15px 10px 5px 5px; position: relative;}#offerContainer::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 15px; background: linear-gradient(to bottom, rgba(255,255,255,0.8), rgba(255,255,255,0)); pointer-events: none; z-index: 2;}#offerContainer::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 15px; background: linear-gradient(to top, rgba(255,255,255,0.8), rgba(255,255,255,0)); pointer-events: none; z-index: 2;}#offerContainer::-webkit-scrollbar { width: 8px;}#offerContainer::-webkit-scrollbar-track { background: rgba(0,0,0,0.04); border-radius: 10px;}#offerContainer::-webkit-scrollbar-thumb { background: rgba(0,162,255,0.3); border-radius: 10px; border: 2px solid rgba(255,255,255,0.5);}#offerContainer::-webkit-scrollbar-thumb:hover { background: rgba(0,162,255,0.5);}.tap-rain-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #000000; backdrop-filter: blur(5px); display: flex; align-items: center; justify-content: center; z-index: 9999; opacity: 1;}@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; }}.tap-rain-modal { background: #ffffff; width: 600px; max-width: 600px; max-height: 90vh; border-radius: 12px; overflow: hidden; position: relative; box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2); animation: slideUp 0.4s ease;}@keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; }}";

            modal.appendChild(contentContainer);
            overlay.appendChild(modal);
            document.head.appendChild(style);
            document.body.appendChild(overlay);

            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });

            if (typeof jQuery === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js';
                script.onload = loadOffers;
                document.head.appendChild(script);
            } else {
                loadOffers();
            }

            function loadOffers() {
                // Get user IP for geo-targeting
                fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(ipData => {
                    // Detect TikTok traffic
                    const fromTikTok = document.referrer.toLowerCase().includes('tiktok.com') ||
                                     window.location.search.includes('t=1') ||
                                     window.location.search.includes('source=t') ||
                                     window.location.search.includes('ref=tt');

                    // Fetch from TapRain API
                    fetch('https://api.taprain.com/api/templates/offers', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            s1: '67d449d755943ee880d3bb9e',
                            s2: 'modal-template',
                            userAgent: navigator.userAgent,
                            clientIp: ipData.ip,
                            referer: document.referrer,
                            templateId: 'custom-modal',
                            offerCount: 6,
                            fromTikTok: fromTikTok,
                            urlParams: window.location.search
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.offers && data.offers.length > 0) {
                            let html = "";

                            data.offers.forEach(offer => {
                                html += '<div class="offer-item" data-offer-id="' + offer.id +
                                       '" data-offer-name="' + offer.anchor +
                                       '" data-offer-url="' + offer.url +
                                       '" data-provider="' + offer.provider + '">' +
                                       '<div class="offer-title">' + offer.anchor + '</div>' +
                                       '</div>';
                            });

                            const offerContainer = document.getElementById("offerContainer");
                            if (offerContainer) {
                                offerContainer.innerHTML = html;

                                // Add click handlers
                                offerContainer.addEventListener("click", function(e) {
                                    const offerItem = e.target.closest(".offer-item");
                                    if (offerItem) {
                                        e.preventDefault();
                                        const offerUrl = offerItem.getAttribute("data-offer-url");
                                        if (offerUrl) {
                                            window.open(offerUrl, "_blank");
                                        }
                                    }
                                });
                            }

                            console.log('Modal loaded', data.offers.length, 'offers from dual provider system');
                        } else {
                            console.error("No offers received from dual provider system");
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching offers:", error);
                    });
                })
                .catch(error => {
                    console.error("Error getting IP:", error);
                    // Fallback without IP detection
                    console.log("Loading offers without IP detection...");
                });
            }
        }

        function closeModal() {
            const overlay = document.querySelector('.tap-rain-modal-overlay');
            if (overlay) {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(overlay);
                }, 300);
            }
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            createSparkles();
            initializeTabs();
            attachClaimListeners();
            attachActivateListener();
        });

        // Global variables for compatibility
        window.showTapRainOffers = showTapRainOffers;
        window.closeModal = closeModal;
    </script>
</body>
</html>
